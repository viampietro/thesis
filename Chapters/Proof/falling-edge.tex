%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% FALLING EDGE HYPOTHESES %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{definition}[Falling Edge Hypotheses]
  \label{def:fe-hyps}
  Given an $sitpn\in{}SITPN$, $d\in{}design$,
  $\gamma\in{}WM(sitpn,d)$,
  $E_c\in\mathbb{N}\rightarrow\mathcal{C}\rightarrow\mathbb{B}$,
  $\Delta\in{}ElDesign(d,\mathcal{D}_\mathcal{H})$,
  $E_p\in(\mathbb{N}\times\{\uparrow,\downarrow\})\rightarrow{}Ins(\Delta)\rightarrow{}value$,
  $\tau\in\mathbb{N}$, $s,s'\in{}S(sitpn)$,
  $\sigma_e,\sigma,\sigma_i,\sigma_\downarrow,\sigma'\in\Sigma(\Delta)$,
  assume that:
  \begin{itemize}
  \item $\lfloor{}sitpn\rfloor_\mathcal{H}=(d,\gamma)$ and
    $\gamma\vdash{}E_p\stackrel{env}{=}E_c$ and
    $\mathcal{D}_\mathcal{H},\emptyset\vdash\mathrm{d}\srarrow{elab}{\fontsize{5}{7}\selectfont}\Delta,\sigma_e$
  \item $\gamma,E_c,\tau\vdash{}s\stackrel{\uparrow}{\sim}\sigma$
  \item $E_c,\tau\vdash{}sitpn,s\xrightarrow{\downarrow}s'$
  \item $\mathtt{Inject}_\downarrow(\sigma, E_p, \tau, \sigma_i)$
    and
    $\Delta,\sigma_i\vdash\mathrm{d.cs}\xrightarrow{\downarrow}\sigma_{\downarrow}$
    and
    $\Delta,\sigma_{\downarrow}\vdash\mathrm{d.cs}\xrightarrow{\rightsquigarrow}\sigma'$
  \item State $\sigma$ is a stable design state:
    $\mathcal{D}_{\mathcal{H}},\Delta,\sigma\vdash\mathrm{d.cs}\xrightarrow{comb}\sigma$
  \end{itemize}
\end{definition}

\def\fehyps{For all $sitpn$, $d$, $\gamma$, $\Delta$, $\sigma_e$,
  $E_c$, $E_p$, $\tau$, $s$, $s'$, $\sigma$, $\sigma_i$,
  $\sigma_{\downarrow}$, $\sigma'$ that verify the hypotheses of
  Def.~\ref{def:fe-hyps},}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%%%%%%%%% FALLING EDGE LEMMA %%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

\begin{lemma}[Falling Edge]
  \label{lem:fe}
  \fehyps{} then $\gamma\vdash{}s'\stackrel{\downarrow}{\sim}{}\sigma'$.
\end{lemma}

\begin{proof}
  By definition of \nameref{def:post-fe-state-sim}, there are 12
  points to prove.
  \begin{frameb}
    \begin{enumerate}
    \item
      $\forall{}p\in{}P,id_p\in{}Comps(\Delta)~s.t.~\gamma(p)=id_p,$
      $~s'.M(p)=\sigma'(id_p)("s\_marking")$.\label{item:6}
    \item
      $\forall{}t\in{}T_i,id_t\in{}Comps(\Delta)~s.t.~\gamma(t)=id_t,$\\
      $\big(upper(I_s(t))=\infty\land{}s'.I(t)\le{}lower(I_s(t))\Rightarrow{}s'.I(t)=\sigma'(id_t)("s\_time\_counter")\big)$\\
      $\land\big(upper(I_s(t))=\infty\land{}s'.I(t)>{}lower(I_s(t))\Rightarrow{}\sigma'(id_t)("s\_time\_counter")=lower(I_s(t))\big)$\\
      $\land\big(upper(I_s(t))\neq\infty\land{}s'.I(t)>{}upper(I_s(t))\Rightarrow{}\sigma'(id_t)("s\_time\_counter")=upper(I_s(t))\big)$\\
      $\land\big(upper(I_s(t))\neq\infty\land{}s'.I(t)\le{}upper(I_s(t))\Rightarrow{}s'.I(t)=\sigma'(id_t)("s\_time\_counter")\big)$.\label{item:9}
    \item
      $\forall{}t\in{}T_i,id_t\in{}Comps(\Delta)~s.t.~\gamma(t)=id_t,$
      $s'.reset_t(t)=\sigma'(id_t)("s\_reinit\_time\_counter")$.
    \item
      $\forall{}c\in\mathcal{C},id_c\in{}Ins(\Delta)~s.t.~\gamma(c)=id_c,~s'.cond(c)=\sigma'(id_c)$.
    \item
      $\forall{}a\in\mathcal{A},id_a\in{}Outs(\Delta)~s.t.~\gamma(a)=id_a,~s'.ex(a)=\sigma'(id_a)$.
    \item
      $\forall{}f\in\mathcal{F},id_f\in{}Outs(\Delta)~s.t.~\gamma(f)=id_f,~s'.ex(f)=\sigma'(id_f)$.
    \item
      $\forall{}t\in{}T,id_t\in{}Comps(\Delta)~s.t.~\gamma(t)=id_t,$
      $t\in{}Firable(s')\Leftrightarrow\sigma'(id_t)("s\_firable")=\mathtt{true}$.
    \item
      $\forall{}t\in{}T,id_t\in{}Comps(\Delta)~s.t.~\gamma(t)=id_t,$
      $t\notin{}Firable(s')\Leftrightarrow\sigma'(id_t)("s\_firable")=\mathtt{false}$.
    \item
      $\forall{}t\in{}T,id_t\in{}Comps(\Delta)~s.t.~\gamma(t)=id_t,$
      $t\in{}Fired(s')\Leftrightarrow\sigma'(id_t)("fired")=\mathtt{true}$.
    \item
      $\forall{}t\in{}T,id_t\in{}Comps(\Delta)~s.t.~\gamma(t)=id_t,$
      $t\notin{}Fired(s')\Leftrightarrow\sigma'(id_t)("fired")=\mathtt{false}$.
    \item
      $\forall{}p\in{}P,id_p\in{}Comps(\Delta)~s.t.~\gamma(p)=id_p,$
      $\sum\limits_{t\in{}Fired(s')}pre(p,t)=\sigma'(id_p)("s\_output\_token\_sum")$.\label{item:7}
    \item
      $\forall{}p\in{}P,id_p\in{}Comps(\Delta)~s.t.~\gamma(p)=id_p,$
      $\sum\limits_{t\in{}Fired(s')}post(t,p)=\sigma'(id_p)("s\_input\_token\_sum")$.\label{item:8}
    \end{enumerate}
  \end{frameb}

  Each point is proved by a separate lemma:
  \begin{itemize}[label=--]
  \item Apply Lemma~\nameref{lem:fe-equal-marking} to solve
    \ref{item:6}.
  \item Apply Lemma~\nameref{lem:fe-equal-tc} to solve \ref{item:9}.
  \item Apply Lemma~\nameref{lem:fe-equal-ots} to solve \ref{item:7}.
  \item Apply Lemma~\nameref{lem:fe-equal-its} to solve \ref{item:8}.
  \end{itemize}
  
\end{proof}

\subsection{Falling Edge and marking}
\label{sec:fe-marking}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% FALLING EDGE EQUAL MARKING LEMMA %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{lemma}[Falling Edge Equal Marking]
  \label{lem:fe-equal-marking}
  \fehyps{} then
  $\forall{}p\in{}P,id_p\in{}Comps(\Delta)~s.t.~\gamma(p)=id_p,$
  $~s'.M(p)=\sigma'(id_p)("s\_marking")$.
\end{lemma}

\begin{proof}
  Given a $p\in{}P$ and an $id\in{}Comps(\Delta)$
  s.t. $\gamma(p)=id_p$, let us show\\
  \fbox{$s'.M(p)=\sigma'(id_p)("s\_marking")$.}

  \noindent{}By definition of
  $E_c,\tau\vdash{}sitpn,s\xrightarrow{\downarrow}s'$:
  \begin{equation}
    \label{eq:42}s.M(p)=s'.M(p)
  \end{equation}

  \noindent{}By property of the $\mathtt{Inject}_\downarrow$ relation,
  the \hvhdl{} falling edge relation, the stabilize relation and
  \InCsCompP:
  \begin{equation}
    \label{eq:43}\sigma'(id_p)("s\_marking")=\sigma(id_p)("s\_marking")
  \end{equation}

  \noindent{}Rewriting the goal with \eqref{eq:42} and \eqref{eq:43}:
  \fbox{$s.M(p)=\sigma(id_p)("s\_marking")$.}

  \noindent{}By definition of
  $\gamma,E_c,\tau\vdash{}s\stackrel{\uparrow}{\sim}\sigma$:
  \qedbox{$s.M(p)=\sigma(id_p)("s\_marking")$.}
  
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% FALLING EDGE EQUAL OUTPUT TOKEN SUM LEMMA %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{lemma}[Falling Edge Equal Output Token Sum]
  \label{lem:fe-equal-ots}
  \fehyps{} then $\forall{}p,id_p~s.t.~\gamma(p)=id_p$,
  $\sum\limits_{t\in{}Fired(s')}pre(p,t)=\sigma'(id_p)("s\_output\_token\_sum")$.
\end{lemma}

\begin{proof}
  Given a $p\in{}P$ and an $id_p\in{}Comps(\Delta)$, let us show\\
  \fbox{$\sum\limits_{t\in{}Fired(s')}pre(p,t)=\sigma'(id_p)("s\_output\_token\_sum")$.}

  \exP{}
  
  \noindent{}By property of the stabilize relation and \InCsCompP{}:
  \begin{equation}
    \label{eq:16}
    \sigma'(id_p)("sots")=\sum\limits_{i=0}^{\Delta(id_p)("oan")-1}
    \begin{cases}
      \sigma'(id_p)("oaw")[i]~\mathtt{if}~(\sigma'(id_p)("otf")[i]~ \\
      \hspace{19.5ex}.~\sigma'(id_p)("oat")[i]=\mathtt{BASIC}) \\
      0~otherwise \\
    \end{cases}
  \end{equation}

  \noindent{}Rewriting the goal with \eqref{eq:16}:\\
  \begin{equation*}
    \fbox{$
      \sum\limits_{t\in{}Fired(s')}pre(p,t)=\sum\limits_{i=0}^{\Delta(id_p)("oan")-1}
      \begin{cases}
        \sigma'(id_p)("oaw")[i]~\mathtt{if}~(\sigma'(id_p)("otf")[i]~ \\
        \hspace{19.5ex}.~\sigma'(id_p)("oat")[i]=\mathtt{BASIC}) \\
        0~otherwise \\
      \end{cases}$}
  \end{equation*}

  \noindent{}Let us unfold the definition of the left sum term:\\
  \fbox{
    {\begin{tabular}{c}
       $\sum\limits_{t\in{}Fired(s')}
       \begin{cases}
         \omega~\mathtt{if}~pre(p,t)=(\omega,\mathtt{basic}) \\
         0~otherwise
       \end{cases}$ \\
       $=$ \\
       $\sum\limits_{i=0}^{\Delta(id_p)("oan")-1}
       \begin{cases}
         \sigma'(id_p)("oaw")[i]~\mathtt{if}~(\sigma'(id_p)("otf")[i]~ \\
         \hspace{19.5ex}.~\sigma'(id_p)("oat")[i]=\mathtt{BASIC}) \\
         0~otherwise \\
       \end{cases}$ \\
     \end{tabular}}
 }\\

 \noindent{}To ease the reading, let us define functions
 $f\in{}Fired(s')\rightarrow\mathbb{N}$ and
 $g\in[0,\vert{}output(p)\vert-1]\rightarrow\mathbb{N}$ s.t.
 $f(t)=\begin{cases}
   \omega~\mathtt{if}~pre(p,t)=(\omega,\mathtt{basic}) \\
   0~otherwise
 \end{cases}$ and $g(i)=\begin{cases}
   \sigma'(id_p)("oaw")[i]~\mathtt{if}~(\sigma'(id_p)("otf")[i]~ \\
   \hspace{19.5ex}.~\sigma'(id_p)("oat")[i]=\mathtt{BASIC}) \\
   0~otherwise \\
 \end{cases}$

 \noindent{}Then, the goal is: \fbox{$\sum\limits_{t\in{}Fired(s')}f(t)=\sum\limits_{i=0}^{\Delta(id_p)("oan")-1}g(i)$}\\

 \noindent{}Let us perform case analysis on $output(p)$; there are two cases:

 \begin{enumerate}
 \item $output(p)=\emptyset$:\\
   
   \noindent{}By construction,
   ${<}\mathtt{output\_arcs\_number\Rightarrow{}1}{>}\in{}gm_p$,
   ${<}\mathtt{output\_arcs\_types(0)\Rightarrow{}\mathtt{BASIC}}{>}\in{}ipm_p$,
   ${<}\mathtt{output\_transitions\_fired(0)\Rightarrow{}\mathtt{true}}{>}\in{}ipm_p$,
   and
   ${<}\mathtt{output\_arcs\_weights(0)\Rightarrow{}0}{>}\in{}ipm_p$.

   \noindent{}By property of the elaboration relation and \InCsCompP:
   \begin{equation}
     \label{eq:25}\Delta(id_p)("oan")=1
   \end{equation}

   \noindent{}By property of the stabilize relation and \InCsCompP:
   \begin{eqnarray}
     \label{eq:26}\sigma'(id_p)("oat")[0]&=&\mathtt{BASIC}\\
     \label{eq:27}\sigma'(id_p)("otf")[0]&=&\mathtt{true}\\
     \label{eq:28}\sigma'(id_p)("oaw")[0]&=&0
   \end{eqnarray}

   By property of $output(p)=\emptyset$:
   \begin{equation}\label{eq:29}
     \sum\limits_{t\in{}Fired(s')}
     \begin{cases}
       \omega~\mathtt{if}~pre(p,t)=(\omega,\mathtt{basic}) \\
       0~otherwise
     \end{cases}=0
   \end{equation}

   \noindent{}Rewriting the goal with \eqref{eq:25}, \eqref{eq:26},
   \eqref{eq:27}, \eqref{eq:28} and \eqref{eq:29}, \qedbox{tautology.}
   
 \item $output(p)\neq\emptyset$:\\

   \noindent{}By construction,
   ${<}\mathtt{output\_arcs\_number\Rightarrow{}}\vert{}output(p)\vert{>}\in{}gm_p$,
   and by property of the elaboration relation:
   \begin{equation}
     \label{eq:30}\Delta(id_p)("oan")=\vert{}output(p)\vert
   \end{equation}
   
   Rewriting the goal with \eqref{eq:30}:
   \fbox{$\sum\limits_{t\in{}Fired(s')}f(t)=\sum\limits_{i=0}^{\vert{}output(p)\vert-1}g(i)$.}

   \noindent{}Let us reason by induction on the right sum term of the goal.

   \begin{itemize}
   \item \textbf{BASE CASE}:\\

     \noindent{}In that case, $0>\vert{}output\vert-1$ and
     $\sum\limits_{i=0}^{\vert{}output(p)\vert-1}g(i)=0$.

     \noindent{}As $0>\vert{}output\vert-1$, then
     $\vert{}output(p)\vert=0$, thus \qedbox{contradicting
       $output(p)\neq\emptyset$.}

   \item \textbf{INDUCTION CASE}:\\

     \noindent{}In that case, $0\le\vert{}output(p)\vert-1$.
     
     \begin{ih}
       $\forall{}F\subseteq{}Fired(s'),$
       $g(0)+\sum\limits_{t\in{}F}f(t)=g(0)+\sum\limits_{i=1}^{\vert{}output(p)\vert-1}g(i)$
     \end{ih}

     \fbox{$\sum\limits_{t\in{}Fired(s')}f(t)=g(0)+\sum\limits_{i=1}^{\vert{}output(p)\vert-1}g(i)$}

     By definition of $g$:
     \begin{equation}
       \label{eq:31}g(0)=\begin{cases}
         \sigma'(id_p)("oaw")[0]~\mathtt{if}~(\sigma'(id_p)("otf")[0] \\
         \hspace{19.5ex}.~\sigma'(id_p)("oat")[0]=\mathtt{BASIC}) \\
         0~otherwise \\
       \end{cases}
     \end{equation}

     \noindent{}Let us perform case analysis on the value of
     $\sigma'(id_p)("otf")[0]~.~\sigma'(id_p)("oat")[0]=\mathtt{BASIC}$; there are two cases:
     \begin{enumerate}
     \item $(\sigma'(id_p)("otf")[0]~.~\sigma'(id_p)("oat")[0]=\mathtt{BASIC})=\mathtt{false}$:\\
       In that case, $g(0)=0$, and then we can apply the induction
       hypothesis with $F=Fired(s')$ to solve the goal:
       \qedbox{$\sum\limits_{t\in{}Fired(s')}f(t)=\sum\limits_{i=1}^{\vert{}output(p)\vert-1}g(i)$.}

     \item $(\sigma'(id_p)("otf")[0]~.~\sigma'(id_p)("oat")[0]=\mathtt{BASIC})=\mathtt{true}$:\\
       In that case, $g(0)=\sigma'(id_p)("oaw")[0]$,
       $\sigma'(id_p)("otf")[0]=\mathtt{true}$ and\\
       $\sigma'(id_p)("oat")[0]=\mathtt{BASIC}$.

       \noindent{}By construction, there exist a $t\in{}output(t)$,
       $id_t\in{}Comps(\Delta)$ s.t. $\gamma(t)=id_t$. Let us take
       such a $t\in{}output(p)$.

       \exT{}

       \noindent{}As $t\in{}output(p)$, there exist
       $\omega\in\mathbb{N}^{*}$ and
       $a\in\{\mathtt{BASIC},\mathtt{TEST},\mathtt{INHIB}\}$
       s.t. $pre(p,t)=(\omega,a)$. Let us take an $\omega$ and $a$
       s.t. $pre(p,t)=(\omega,a)$.

       \noindent{}By construction,
       ${<}\mathtt{output\_arcs\_types(0)\Rightarrow{}}a{>}\in{}ipm_p$,\\
       ${<}\mathtt{output\_arcs\_weights(0)\Rightarrow{}}\omega{>}\in{}ipm_p$,
       and there exists $id_{ft}\in{}Sigs(\Delta)$ s.t.
       ${<}\mathtt{fired\Rightarrow}id_{ft}{>}\in{}opm_t$ and
       ${<}\mathtt{output\_transitions\_fired(0)\Rightarrow{}id_{ft}}{>}\in{}ipm_p$

       \noindent{}By property of the stabilize relation,
       $\sigma'(id_p)("oat")[0]=\mathtt{BASIC}$ and\\
       ${<}\mathtt{output\_arcs\_types(0)\Rightarrow{}a}{>}\in{}ipm_p$:
       \begin{equation}
         \label{eq:32}pre(p,t)=(\omega,\mathtt{basic})
       \end{equation}

       \noindent{}By property of the stabilize relation,
       ${<}\mathtt{fired\Rightarrow{}id_{ft}}{>}\in{}opm_t$,\\
       ${<}\mathtt{output\_transitions\_fired(0)\Rightarrow{}id_{ft}}{>}\in{}ipm_p$
       and $\sigma'(id_p)("otf")[0]=\mathtt{true}$:
       \begin{equation}
         \label{eq:33}\sigma'(id_t)("fired")=\mathtt{true}
       \end{equation}

       \noindent{}Appealing to Lemma~\ref{lem:fe-equal-fired}, we know
       $t\in{}Fired(s')$.

       \noindent{}As $t\in{}Fired(s')$, we can rewrite the left sum
       term of the goal as follows:\\
       \fbox{$f(t)+\sum\limits_{t'\in{}Fired(s')\setminus\{t\}}f(t')=g(0)+\sum\limits_{i=1}^{\vert{}output(p)\vert-1}g(i)$}

       \noindent{}We know that $g(0)=\sigma'(id_p)("oaw")[0]$, and by
       property of the stabilize relation and
       ${<}\mathtt{output\_arcs\_weights(0)\Rightarrow}\omega{>}\in{}ipm_p$:
       \begin{equation}
         \label{eq:21}\sigma'(id_p)("oaw")[0]=\omega
       \end{equation}

       Rewriting the goal with \eqref{eq:21}:\\
       \fbox{$f(t)+\sum\limits_{t'\in{}Fired(s')\setminus\{t\}}f(t')=\omega+\sum\limits_{i=1}^{\vert{}output(p)\vert-1}g(i)$}

       By definition of $f$, and as $pre(p,t)=(\omega,\mathtt{basic})$, then $f(t)=\omega$; thus, rewriting the goal:\\
       \fbox{$\omega+\sum\limits_{t'\in{}Fired(s')\setminus\{t\}}f(t')=\omega+\sum\limits_{i=1}^{\vert{}output(p)\vert-1}g(i)$}

       Then, knowing that $g(0)=\omega$, we can apply the induction
       hypothesis with $F=Fired(s')\setminus\{t\}$:
       \qedbox{$g(0)+\sum\limits_{t'\in{}Fired(s')\setminus\{t\}}f(t')=g(0)+\sum\limits_{i=1}^{\vert{}output(p)\vert-1}g(i)$.}
     \end{enumerate}
     
   \end{itemize}
   

 \end{enumerate}
 
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% FALLING EDGE EQUAL INPUT TOKEN SUM LEMMA %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{lemma}[Falling Edge Equal Input Token Sum]
  \label{lem:fe-equal-its}
  \fehyps{} then $\forall{}p,id_p~s.t.~\gamma(p)=id_p$,
  $~\sum\limits_{t\in{}Fired(s')}post(t,p)=\sigma'_p("s\_input\_token\_sum")$.
\end{lemma}

\begin{proof}
  Given a $p\in{}P$ and an $id_p\in{}Comps(\Delta)$, let us show\\
  \fbox{$\sum\limits_{t\in{}Fired(s')}post(t,p)=\sigma'(id_p)("s\_input\_token\_sum")$.}\\

  \exP{}
  
  \noindent{}By property of the stabilize relation and \InCsCompP{}:
  \begin{equation}
    \label{eq:34}
    \sigma'(id_p)("sits")=\sum\limits_{i=0}^{\Delta(id_p)("ian")-1}
    \begin{cases}
      \sigma'(id_p)("iaw")[i]~\mathtt{if}~\sigma'(id_p)("itf")[i]\\
      0~otherwise \\
    \end{cases}
  \end{equation}

  \noindent{}Rewriting the goal with \eqref{eq:34}:\\
  \begin{equation*}
    \fbox{$
      \sum\limits_{t\in{}Fired(s')}post(t,p)=\sum\limits_{i=0}^{\Delta(id_p)("ian")-1}
      \begin{cases}
        \sigma'(id_p)("iaw")[i]~\mathtt{if}~\sigma'(id_p)("otf")[i]\\
        0~otherwise \\
      \end{cases}$}
  \end{equation*}

  \noindent{}Let us unfold the definition of the left sum term:\\
  \fbox{
    {\begin{tabular}{c}
       $\sum\limits_{t\in{}Fired(s')}
       \begin{cases}
         \omega~\mathtt{if}~post(t,p)=\omega \\
         0~otherwise
       \end{cases}$ \\
       $=$ \\
       $\sum\limits_{i=0}^{\Delta(id_p)("ian")-1}
       \begin{cases}
         \sigma'(id_p)("iaw")[i]~\mathtt{if}~\sigma'(id_p)("itf")[i]\\
         0~otherwise \\
       \end{cases}$ \\
     \end{tabular}}
 }\\

 \noindent{}Let us perform case analysis on $input(p)$; there are two cases:

 \begin{enumerate}
 \item $input(p)=\emptyset$:\\
   
   \noindent{}By construction,
   ${<}\mathtt{input\_arcs\_number\Rightarrow{}1}{>}\in{}gm_p$,
   ${<}\mathtt{input\_transitions\_fired(0)\Rightarrow{}\mathtt{true}}{>}\in{}ipm_p$,
   and
   ${<}\mathtt{input\_arcs\_weights(0)\Rightarrow{}0}{>}\in{}ipm_p$.

   \noindent{}By property of the elaboration relation and \InCsCompP:
   \begin{equation}
     \label{eq:35}\Delta(id_p)("ian")=1
   \end{equation}

   \noindent{}By property of the stabilize relation and \InCsCompP:
   \begin{eqnarray}
     \label{eq:36}\sigma'(id_p)("itf")[0]&=&\mathtt{true}\\
     \label{eq:37}\sigma'(id_p)("iaw")[0]&=&0
   \end{eqnarray}

   By property of $input(p)=\emptyset$:
   \begin{equation}\label{eq:23}
     \sum\limits_{t\in{}Fired(s')}
     \begin{cases}
       \omega~\mathtt{if}~post(t,p)=\omega \\
       0~otherwise
     \end{cases}=0
   \end{equation}

   \noindent{}Rewriting the goal with \eqref{eq:35}, \eqref{eq:36},
   \eqref{eq:37}, and \eqref{eq:23}, and simplifying the goal,
   \qedbox{tautology.}
   
 \item $input(p)\neq\emptyset$:\\

   \noindent{}By construction,
   ${<}\mathtt{input\_arcs\_number\Rightarrow{}}\vert{}input(p)\vert{>}\in{}gm_p$,
   and by property of the elaboration relation:
   \begin{equation}
     \label{eq:24}\Delta(id_p)("ian")=\vert{}input(p)\vert
   \end{equation}

   \noindent{}To ease the reading, let us define functions
   $f\in{}Fired(s')\rightarrow\mathbb{N}$ and
   $g\in[0,\vert{}input(p)\vert-1]\rightarrow\mathbb{N}$ s.t.
   $f(t)=\begin{cases}
     \omega~\mathtt{if}~post(t,p)=\omega \\
     0~otherwise
   \end{cases}$ and \\ $g(i)=\begin{cases}
     \sigma'(id_p)("iaw")[i]~\mathtt{if}~\sigma'(id_p)("itf")[i]\\
     0~otherwise \\
   \end{cases}$

   \noindent{}Then, the goal is: \fbox{$\sum\limits_{t\in{}Fired(s')}f(t)=\sum\limits_{i=0}^{\Delta(id_p)("ian")-1}g(i)$}\\
   
   Rewriting the goal with \eqref{eq:24}:
   \fbox{$\sum\limits_{t\in{}Fired(s')}f(t)=\sum\limits_{i=0}^{\vert{}input(p)\vert-1}g(i)$.}

   \noindent{}Let us reason by induction on the right sum term of the goal.

   \begin{itemize}
   \item \textbf{BASE CASE}:\\
     \noindent{}In that case, $0>\vert{}input(p)\vert-1$ and
     $\sum\limits_{i=0}^{\vert{}input(p)\vert-1}g(i)=0$.

     \noindent{}As $0>\vert{}input(p)\vert-1$, then
     $\vert{}input(p)\vert=0$, thus \qedbox{contradicting
       $input(p)\neq\emptyset$.}

   \item \textbf{INDUCTION CASE}:\\
     \noindent{}In that case, $0\le\vert{}input(p)\vert-1$.
     
     \begin{ih}
       $\forall{}F\subseteq{}Fired(s'),~$
       $g(0)+\sum\limits_{t\in{}F}f(t)=g(0)+\sum\limits_{i=1}^{\vert{}input(p)\vert-1}g(i)$
     \end{ih}

     \fbox{$\sum\limits_{t\in{}Fired(s')}f(t)=g(0)+\sum\limits_{i=1}^{\vert{}input(p)\vert-1}g(i)$}\\

     By definition of $g$:
     \begin{equation}
       \label{eq:38}g(0)=\begin{cases}
         \sigma'(id_p)("iaw")[0]~\mathtt{if}~\sigma'(id_p)("itf")[0]\\
         0~otherwise \\
       \end{cases}
     \end{equation}

     \noindent{}Let us perform case analysis on the value of
     $\sigma'(id_p)("itf")[0]$; there are two cases:
     \begin{enumerate}
     \item $\sigma'(id_p)("itf")[0]=\mathtt{false}$:\\
       In that case, $g(0)=0$, and then we can apply the induction
       hypothesis with $F=Fired(s')$ to solve the goal:
       \qedbox{$\sum\limits_{t\in{}Fired(s')}f(t)=\sum\limits_{i=1}^{\vert{}input(p)\vert-1}g(i)$.}

     \item $\sigma'(id_p)("itf")[0]=\mathtt{true}$:\\
       In that case, $g(0)=\sigma'(id_p)("iaw")[0]$ and
       $\sigma'(id_p)("itf")[0]=\mathtt{true}$ .

       \noindent{}By construction, there exist a $t\in{}input(t)$,
       $id_t\in{}Comps(\Delta)$ s.t. $\gamma(t)=id_t$. Let us take
       such a $t\in{}input(p)$.

       \exT{}

       \noindent{}As $t\in{}input(p)$, there exist
       $\omega\in\mathbb{N}^{*}$ s.t. $post(t,p)=\omega$. Let us take
       an $\omega$ s.t. $post(t,p)=\omega$.

       \noindent{}By construction,
       ${<}\mathtt{input\_arcs\_weights(0)\Rightarrow{}}\omega{>}\in{}ipm_p$,
       and there exists $id_{ft}\in{}Sigs(\Delta)$ s.t.
       ${<}\mathtt{fired\Rightarrow}id_{ft}{>}\in{}opm_t$ and
       ${<}\mathtt{input\_transitions\_fired(0)\Rightarrow{}id_{ft}}{>}\in{}ipm_p$

       \noindent{}By property of the stabilize relation and
       ${<}\mathtt{input\_arcs\_types(0)\Rightarrow{}a}{>}\in{}ipm_p$:
       \begin{equation}
         \label{eq:39}post(t,p)=\omega
       \end{equation}

       \noindent{}By property of the stabilize relation,
       ${<}\mathtt{fired\Rightarrow{}id_{ft}}{>}\in{}opm_t$,\\
       ${<}\mathtt{input\_transitions\_fired(0)\Rightarrow{}id_{ft}}{>}\in{}ipm_p$
       and $\sigma'(id_p)("itf")[0]=\mathtt{true}$:
       \begin{equation}
         \label{eq:40}\sigma'(id_t)("fired")=\mathtt{true}
       \end{equation}

       \noindent{}Appealing to Lemma~\ref{lem:fe-equal-fired} and
       \eqref{eq:40}, we know $t\in{}Fired(s')$.

       \noindent{}As $t\in{}Fired(s')$, we can rewrite the left sum
       term of the goal as follows:\\
       \fbox{$f(t)+\sum\limits_{t'\in{}Fired(s')\setminus\{t\}}f(t')=g(0)+\sum\limits_{i=1}^{\vert{}input(p)\vert-1}g(i)$}

       \noindent{}We know that $g(0)=\sigma'(id_p)("iaw")[0]$, and by
       property of the stabilize relation and
       ${<}\mathtt{input\_arcs\_weights(0)\Rightarrow}\omega{>}\in{}ipm_p$:
       \begin{equation}
         \label{eq:41}\sigma'(id_p)("iaw")[0]=\omega
       \end{equation}

       Rewriting the goal with \eqref{eq:41}:\\
       \fbox{$f(t)+\sum\limits_{t'\in{}Fired(s')\setminus\{t\}}f(t')=\omega+\sum\limits_{i=1}^{\vert{}input(p)\vert-1}g(i)$}

       By definition of $f$, and as $post(t,p)=\omega$, then $f(t)=\omega$; thus, rewriting the goal:\\
       \fbox{$\omega+\sum\limits_{t'\in{}Fired(s')\setminus\{t\}}f(t')=\omega+\sum\limits_{i=1}^{\vert{}input(p)\vert-1}g(i)$}

       Then, knowing that $g(0)=\omega$, we can apply the induction
       hypothesis with $F=Fired(s')\setminus\{t\}$:
       \qedbox{$g(0)+\sum\limits_{t'\in{}Fired(s')\setminus\{t\}}f(t')=g(0)+\sum\limits_{i=1}^{\vert{}input(p)\vert-1}g(i)$.}
     \end{enumerate}
     
   \end{itemize}
   
 \end{enumerate}
 
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% FALLING EDGE EQUAL TIME COUNTERS %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Falling edge and time counters}
\label{sec:fe-equal-tc}

\begin{lemma}[Falling Edge Equal Time Counters]
  \label{lem:fe-equal-tc}
  \fehyps{} then $\forall{}t\in{}T_i,id_t\in{}Comps(\Delta)~s.t.~\gamma(t)=id_t,$\\
  $\big(upper(I_s(t))=\infty\land{}s'.I(t)\le{}lower(I_s(t))\Rightarrow{}s'.I(t)=\sigma'(id_t)("s\_time\_counter")\big)$\\
  $\land\big(upper(I_s(t))=\infty\land{}s'.I(t)>{}lower(I_s(t))\Rightarrow{}\sigma'(id_t)("s\_time\_counter")=lower(I_s(t))\big)$\\
  $\land\big(upper(I_s(t))\neq\infty\land{}s'.I(t)>{}upper(I_s(t))\Rightarrow{}\sigma'(id_t)("s\_time\_counter")=upper(I_s(t))\big)$\\
  $\land\big(upper(I_s(t))\neq\infty\land{}s'.I(t)\le{}upper(I_s(t))\Rightarrow{}s'.I(t)=\sigma'(id_t)("s\_time\_counter")\big)$.
\end{lemma}

\begin{proof}
  Given a $t\in{}T_i$ and an $id_t\in{}Comps(\Delta)$ s.t. $\gamma(t)=id_t$, let us show\\
  \noindent\fbox{\parbox{\lwidth}{$\big(upper(I_s(t))=\infty\land{}s'.I(t)\le{}lower(I_s(t))\Rightarrow$
      $s'.I(t)=\sigma'(id_t)("s\_time\_counter")\big)$\\
      $\land\big(upper(I_s(t))=\infty\land{}s'.I(t)>{}lower(I_s(t))\Rightarrow$
      $\sigma'(id_t)("s\_time\_counter")=lower(I_s(t))\big)$\\
      $\land\big(upper(I_s(t))\neq\infty\land{}s'.I(t)>{}upper(I_s(t))\Rightarrow$
      $\sigma'(id_t)("s\_time\_counter")=upper(I_s(t))\big)$\\
      $\land\big(upper(I_s(t))\neq\infty\land{}s'.I(t)\le{}upper(I_s(t))\Rightarrow$
      $s'.I(t)=\sigma'(id_t)("s\_time\_counter")\big)$}}\\

  \exT\\
  
  \noindent{}Then, there are 4 points to show:

  \begin{enumerate}
  \item\label{it:re-eq-tc-fst}
    \fbox{$upper(I_s(t))=\infty\land{}s'.I(t)\le{}lower(I_s(t))\Rightarrow{}s'.I(t)=\sigma'(id_t)("s\_time\_counter")$}\\
    
    \noindent{}Assuming $upper(I_s(t))=\infty$ and
    $s'.I(t)\le{}lower(I_s(t))$, let us show
    \fbox{$s'.I(t)=\sigma'(id_t)("s\_time\_counter")$.}

    \noindent{}By property of the $\mathtt{Inject}_\uparrow$, \hvhdl{}
    rising edge and stabilize relations, and \\ \InCsCompT:
    \begin{equation}
      \sigma'(id_t)("s\_time\_counter")=\sigma(id_t)("s\_time\_counter")\label{eq:eq-stc-stc}
    \end{equation}
    
  \item
    \fbox{$upper(I_s(t))=\infty\land{}s'.I(t)>{}lower(I_s(t))\Rightarrow$
      $\sigma'(id_t)("s\_time\_counter")=lower(I_s(t)$.}
  \item
    \fbox{$upper(I_s(t))\neq\infty\land{}s'.I(t)>{}upper(I_s(t))\Rightarrow$
      $\sigma'(id_t)("s\_time\_counter")=upper(I_s(t))$.}
  \item
    \fbox{$upper(I_s(t))\neq\infty\land{}s'.I(t)\le{}upper(I_s(t))\Rightarrow$
      $s'.I(t)=\sigma'(id_t)("s\_time\_counter")$.}
  \end{enumerate}
\end{proof}

\subsection{Falling edge and firable transitions}
\label{sec:fe-firable}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% FALLING EDGE EQUAL FIRABLE %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{lemma}[Falling Edge Equal Firable]
  \label{lem:fe-equal-firable}
  \fehyps{} and $\forall{}t,id_t$ s.t. $\gamma(t)=id_t$ and
  $\sigma'(id_t)=\sigma'_t$, then
  $t\in{}Firable(s')\Leftrightarrow\sigma'_t("s\_firable")=\mathtt{true}$.
\end{lemma}

\begin{proof}
  
\end{proof}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../main"
%%% End:
