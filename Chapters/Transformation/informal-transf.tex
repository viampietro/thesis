This section outlines the main phases of the \hilecop{} transformation
function. The goal is to give to the reader the means to appreciate
the differences and the similarities between the \hilecop{}
transformation and the other transformations presented in the
literature review of Section~\ref{sec:transf-lit-rev}. Then,
Section~\ref{sec:trans-alg} will enter the details of the
transformation by presenting the transformation algorithm.

The \hilecop{} model-to-text transformation function takes an SITPN
model as input; then, it generates a top-level \hvhdl{} design out
of the input model. We will illustrate the \hilecop{} model-to-text
transformation on the input SITPN model presented in
Figure~\ref{fig:transf-toplevel}.

\begin{figure}[H]
  \centering
  \includegraphics[keepaspectratio,width=.8\textwidth]{Figures/Transformation/transf-fun-toplevel}
  \caption[Transformation of an input SITPN model into a top-level
  \hvhdl{} design.]{Transformation of an input SITPN model into a
    top-level \hvhdl{} design.  The input model is composed of two
    places, $p_0$ and $p_1$, and two transitions, $t_0$ and
    $t_1$. The transition $t_0$ is associated with the time interval
    $[1,3]$ and the condition $c_0$. The transition $t_1$ is associated
    with the condition $c_1$, and its firing triggers the execution of
    the function $f_0$. The action $a_0$ is activated when the place $p_0$ is
    marked, and the action $a_1$ is activated when the place $p_1$ is marked.
  }
  \label{fig:transf-toplevel}
\end{figure}

The generated top-level design implements the structure of the input
SITPN. As a first step, the transformation generates, for each place of
the input SITPN, a component instance of the \texttt{place} design, and,
for each transition of the input SITPN, a component instance of the
\texttt{transition} design. These subcomponents constitute the main
part of the \hvhdl{} top-level design's behavior. Figure~\ref{fig:transf-arch} 
shows the behavior of the top-level design resulting of this first generation step. 

\begin{figure}[H]
  \centering
  \includegraphics[keepaspectratio,width=\textwidth]{Figures/Transformation/transf-fun-arch}
  \caption[Generation of the \texttt{place} and \texttt{transition}
  component instances.]{Generation of the \texttt{place} and
    \texttt{transition} component instances based on the set of places
    and transitions of the input SITPN. The \texttt{PCI}
    $\mathtt{id}_{p_0}$ implements the place $p_0$, TCI
    $\mathtt{id}_{t_0}$ the transition $t_0$\dots{} In
    \textcolor{red}{red}, the internal signals connected to the
    \texttt{marked} port of PCIs and to the \texttt{fired} port of
    TCIs.}
  \label{fig:transf-arch}
\end{figure}

During this step, each PCI and TCI receive a value for each of their
generic constants through the creation of generic maps.  In the
generic map of a TCI $id_t$ (implementing a transition $t$), the
\texttt{ian} constant is associated with the number of input arcs of
$t$, the \texttt{cn} constant with the number of conditions attached
to $t$, etc.  In the generic map of a PCI $id_p$, the \texttt{ian}
constant is associated with the number of input arcs of $p$, the
\texttt{oan} constant with the number of output arcs of $p$, and the
\texttt{mm} constant with the maximal marking value of $p$. The
maximal marking value associated with a given place $p$ of the input
SITPN is an information passed as a parameter to the transformation
function. This information comes from the analysis of the input SITPN
pertaining to the \textit{boundedness} of the input model. In the
definition of the \hilecop{} methodology, this analysis takes place
before the transformation of the input SITPN into a \hvhdl{} design.

During the first transformation step, illustrated in
Figure~\ref{fig:transf-arch}, the input and output port maps of PCIs
and TCIs are also partly generated. In the manner of the generic
constants in generic maps, some input ports are associated with
constant values in the input port maps of PCIs and TCIs. All these
associations are generated during this first step. Also, the
\texttt{marked} output port of every PCI is associated with an
internal signal in the output port map of the PCI. The internal signal
will be connected later in the course of the transformation. The same
holds for the \texttt{fired} output port of every TCI.

After this first step, the component instances are interconnected
through their port interfaces.  Figure~\ref{fig:transf-inter}
illustrates the behavior of the top-level design after the
interconnection of PCIs and TCIs.

\begin{figure}[H]
  \centering
  \includegraphics[keepaspectratio,width=\textwidth]{Figures/Transformation/transf-fun-inter}
  \caption[Generation of the interconnections between the
  \texttt{place} and \texttt{transition} component
  instances.]{Generation of the interconnections between the
    \texttt{place} and \texttt{transition} component instances. In
    \textcolor{red}{red}, the internal signals interconnecting the
    PCIs and the TCIs. These signals are generated by the
    transformation. The arrows indicate the sense of propagation of
    the information.  In \textcolor{blue}{blue}, the constant associations (i.e. the generic maps and a part of the input port maps)
    produced during the previous transformation step.}
  \label{fig:transf-inter}
\end{figure}

The PCIs and TCIs interact through their interfaces to exchange
informations. For instance, a PCI $id_p$, implementing a given place
$p$, informs its output TCIs (i.e. the TCIs implementing the output
transitions of $p$) that its current marking enables them. The marking
of a PCI is represented by the value of its internal signal
\texttt{s_marking}. A PCI is the only one to have access to the
current value of its internal signals. Thus, a PCI must communicate to
its output TCIs their sensitization status.  To perform this exchange
of information, the transformation generates an internal signal to
connect a specific output port of a PCI (the \texttt{oav} port) to a
specific input port of the output TCIs (the \texttt{iav} port).
Likewise, a TCI informs its input and output PCIs about its firing
status. The transformation generates an internal signal to connect the
\texttt{fired} output port of a TCI to the \texttt{itf} and
\texttt{otf} input ports of the input and output PCIs.  These
interconnections are performed by adding new associations in the input
port map and output port map of PCIs and TCIs.  Through the execution
of the internal behavior of each PCI and TCI, and, through the
interconnection of component instances, the transformation aims at
generating a design's behavior that, by its very structure, carries
the rules of the SITPN semantics and conforms to the execution of the
input SITPN model. To reduce the size of circuits after the synthesis
on an FPGA card, PCIs and TCIs only communicate with Boolean signals
through their interfaces.

The last part of the transformation deals with the interpretation
elements of the input SITPN, i.e. the conditions, the actions and the
functions. Each condition of the input SITPN leads to the declaration
of a Boolean input port in the port clause of the top-level
design. Then, in the design's behavior, each input port representing a
condition is connected to the \texttt{ic} input port of TCIs. The
interconnection of an input port of the top-level design to the
\texttt{ic} input port of a TCI reflects an existing association
between a transition and a condition of the input SITPN model. For
each action and function of the input SITPN, the transformation
generates a Boolean output port, a.k.a. an \emph{action} or a
\emph{function} port. At runtime, the value of these output ports
represent the activation or execution status of the corresponding
actions and functions.  To determine the value of the action and
function ports, the transformation generates two processes: the
\texttt{action} process and the \texttt{function} process. The
\texttt{action} process is a synchronous process responding to the
falling edge of the clock signal. At the occurrence of the falling
edge of the clock signal, the \texttt{action} process sets the value
of the \emph{action} ports computed from the values of the
\texttt{marked} output ports. The \texttt{marked} port is an output
port of the \texttt{place} design. Through the \texttt{marked} port,
the PCIs inform the outside about their marking status, i.e. if they
possess at least one token or not.  Remember that the transformation
generated an association between the \texttt{marked} output port and
an internal signal in the output port map of PCIs during the first
transformation step. These internal signals are read by the
\texttt{action} process to assign a value to the \textit{action}
ports.  The \texttt{function} process is a synchronous process
responding to the rising edge of the clock signal. At the occurrence
of the rising edge of the clock signal, the \texttt{function} process
sets the value of the \emph{function} ports computed from the values
of the \texttt{fired} output ports. The \texttt{fired} port is an
output port of the \texttt{transition} design. Through the
\texttt{fired} port, the TCIs inform the outside about their firing
status, i.e. if they are fired or not. Remember that, during the first
transformation step, the transformation generated an association
between the \texttt{fired} output port and an internal signal in the
output port map of TCIs. These internal signals are read by the
\texttt{function} process to assign a value to the \textit{function}
ports. Figure~\ref{fig:transf-ports} presents the top-level
$\mathcal{H}$-VHDL design at the end of the transformation.

\begin{figure}[H]
  \centering
  \includegraphics[keepaspectratio,width=\textwidth]{Figures/Transformation/transf-fun-ports}
  \caption[Generation of the input and output ports, and of the
  \texttt{action} and the \texttt{function} process in the \hvhdl{}
  top-level design.]{Generation of the input and output ports, and of
    the \texttt{action} and the \texttt{function} process in the
    \hvhdl{} top-level design. The \emph{primary} input port
    $\mathtt{id}_{c_1}$ (resp. $\mathtt{id}_{c_0}$) implements the
    condition $c_1$ (resp. $c_0$). In \textcolor{ForestGreen}{green},
    the internal signals, generated by the transformation, connecting
    the input ports of the top-level design to the
    \texttt{input_conditions} input port of TCIs. The
    $\mathtt{id}_{a_0}$ and $\mathtt{id}_{a_1}$ output ports reflect
    the activation status of the actions $a_0$ and $a_1$. The
    $\mathtt{id}_{f_0}$ output port reflects the activation status of
    the function $f_0$. In \textcolor{orange}{orange}, the internal
    signals, generated by the transformation, connecting the
    \texttt{marked} and \texttt{fired} output ports of PCIs and TCIs
    to the \texttt{action} and \texttt{function} processes. In
    \textcolor{Purple}{purple}, the representation of the assignments
    performed by the \texttt{action} and \texttt{function} processes
    and that set the value of the action and function ports.}
  \label{fig:transf-ports}
\end{figure}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../main"
%%% End:
